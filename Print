-- TopBarLite.lua
-- Lightweight TopBarPlus-like module (Dropdown + Button)
-- Made for loadstring(game:HttpGet(...))() usage

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")

-- Cleanup if already loaded
if CoreGui:FindFirstChild("TopBarLiteGui") then
	CoreGui.TopBarLiteGui:Destroy()
end

-- Create main ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name = "TopBarLiteGui"
gui.IgnoreGuiInset = true
gui.DisplayOrder = 9999
gui.Parent = CoreGui

-- Registry for icons
local icons = {}

-- Base module
local IconModule = {}

-- Utility: create signal (simple RBXScriptSignal clone)
local function CreateSignal()
	local bind = Instance.new("BindableEvent")
	return {
		Event = bind.Event,
		Fire = function(_, ...)
			bind:Fire(...)
		end,
	}
end

-- Utility: theme defaults
local defaultTheme = {
	Icon = {
		BackgroundColor3 = Color3.fromRGB(35, 35, 35),
		BackgroundTransparency = 0.2,
		IconColor3 = Color3.fromRGB(255, 255, 255),
		LabelColor3 = Color3.fromRGB(220, 220, 220),
		CaptionColor3 = Color3.fromRGB(180, 180, 180)
	},
	Selected = {
		BackgroundColor3 = Color3.fromRGB(80, 80, 200),
		BackgroundTransparency = 0.2
	}
}

-- Helper: Apply theme
local function applyTheme(icon, theme)
	local iconFrame = icon.Frame
	local t = theme.Icon
	iconFrame.BackgroundColor3 = t.BackgroundColor3
	iconFrame.BackgroundTransparency = t.BackgroundTransparency
	icon.IconLabel.TextColor3 = t.LabelColor3
	icon.Caption.TextColor3 = t.CaptionColor3
end

-- Create a new icon
function IconModule.new(name)
	local self = {}
	self.Name = name
	self.Visible = true
	self.Clicked = CreateSignal()
	self._theme = defaultTheme
	self._dropdownOptions = {}

	-- Make UI elements
	local frame = Instance.new("Frame")
	frame.Name = name
	frame.Size = UDim2.new(0, 120, 0, 36)
	frame.BackgroundColor3 = defaultTheme.Icon.BackgroundColor3
	frame.BackgroundTransparency = defaultTheme.Icon.BackgroundTransparency
	frame.BorderSizePixel = 0
	frame.Parent = gui

	local label = Instance.new("TextLabel")
	label.Name = "IconLabel"
	label.Size = UDim2.new(1, 0, 0, 18)
	label.Position = UDim2.new(0, 0, 0, 2)
	label.BackgroundTransparency = 1
	label.Font = Enum.Font.GothamBold
	label.TextSize = 14
	label.TextColor3 = defaultTheme.Icon.LabelColor3
	label.Text = name
	label.Parent = frame

	local caption = Instance.new("TextLabel")
	caption.Name = "Caption"
	caption.Size = UDim2.new(1, 0, 0, 16)
	caption.Position = UDim2.new(0, 0, 0, 18)
	caption.BackgroundTransparency = 1
	caption.Font = Enum.Font.Gotham
	caption.TextSize = 12
	caption.TextColor3 = defaultTheme.Icon.CaptionColor3
	caption.Text = ""
	caption.Parent = frame

	-- Click area
	local button = Instance.new("TextButton")
	button.Name = "ClickArea"
	button.Size = UDim2.new(1, 0, 1, 0)
	button.BackgroundTransparency = 1
	button.Text = ""
	button.Parent = frame

	-- Dropdown
	local dropdown = Instance.new("Frame")
	dropdown.Name = "Dropdown"
	dropdown.Size = UDim2.new(0, 120, 0, 0)
	dropdown.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
	dropdown.Visible = false
	dropdown.ClipsDescendants = true
	dropdown.Parent = gui

	local layout = Instance.new("UIListLayout", dropdown)
	layout.Padding = UDim.new(0, 2)

	-- Internal state
	local dropdownOpen = false

	local function refreshDropdown()
		for _,v in ipairs(dropdown:GetChildren()) do
			if v:IsA("TextButton") then v:Destroy() end
		end
		for _,option in ipairs(self._dropdownOptions) do
			local opt = Instance.new("TextButton")
			opt.Size = UDim2.new(1, -4, 0, 24)
			opt.Position = UDim2.new(0, 2, 0, 0)
			opt.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
			opt.TextColor3 = Color3.fromRGB(240, 240, 240)
			opt.Font = Enum.Font.Gotham
			opt.TextSize = 13
			opt.Text = option
			opt.Parent = dropdown
			opt.MouseButton1Click:Connect(function()
				self.Clicked:Fire(option)
				dropdown.Visible = false
				dropdownOpen = false
			end)
		end
		dropdown.Size = UDim2.new(0, 120, 0, math.min(#self._dropdownOptions * 26, 200))
	end

	-- Button click
	button.MouseButton1Click:Connect(function()
		if #self._dropdownOptions > 0 then
			dropdownOpen = not dropdownOpen
			dropdown.Visible = dropdownOpen
			dropdown.Position = UDim2.new(0, frame.AbsolutePosition.X, 0, frame.AbsolutePosition.Y + 38)
			refreshDropdown()
		else
			self.Clicked:Fire()
		end
	end)

	-- Public methods
	function self:setIcon(id) self.IconId = id end
	function self:setLabel(txt) label.Text = txt end
	function self:setCaption(txt) caption.Text = txt end
	function self:addDropdown(list)
		self._dropdownOptions = list or {}
		refreshDropdown()
	end
	function self:setTheme(theme)
		self._theme = theme
		applyTheme(self, theme)
	end
	function self:setVisible(v)
		self.Visible = v
		frame.Visible = v
	end

	-- Store references
	self.Frame = frame
	self.IconLabel = label
	self.Caption = caption
	self.Dropdown = dropdown

	-- layout icons horizontally
	local offset = (#icons) * 130
	frame.Position = UDim2.new(0, offset + 6, 0, 6)

	icons[#icons + 1] = self

	return self
end

-- Return all icons
function IconModule.getIcons()
	return icons
end

return IconModule
end

-- Demo on load
local demoIcon = IconModule.new("Demo")
demoIcon:setLabel("Demo Icon")
demoIcon:setCaption("Click me!")
demoIcon:setIcon(4483345998) -- Example Roblox icon ID
demoIcon:addDropdown({"Option 1", "Option 2", "Option 3"})

demoIcon.Clicked.Event:Connect(function(option)
    print("Clicked! Option:", option or "No option")
end)

-- Export
return IconModule

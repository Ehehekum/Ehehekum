--[[  
    TopLitePlus.lua
    Lightweight TopBar-style GUI Library for Roblox
    Versi: 1.0
    Gaya: Flat minimal, mirip TopBarPlus
    Dibuat oleh: Arka D. Vizura (Roblox Visual Designer Hybrid)
--]]

local TopLitePlus = {}
TopLitePlus.__index = TopLitePlus

--== Service ==--
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

--== Utility ==--
local function create(class, props)
	local inst = Instance.new(class)
	for k, v in pairs(props or {}) do
		inst[k] = v
	end
	return inst
end

--== CLASS: DropdownButton ==--
local DropdownButton = {}
DropdownButton.__index = DropdownButton

function DropdownButton:AddDropdown(items, callback)
	local dropdown = create("Frame", {
		Name = "Dropdown",
		Parent = self.Button,
		Size = UDim2.new(1, 0, 0, #items * 28),
		Position = UDim2.new(0, 0, 1, 4),
		BackgroundColor3 = Color3.fromHex("#1E293B"),
		BackgroundTransparency = 0.05,
		Visible = false,
		ZIndex = 10,
	})
	create("UICorner", {Parent = dropdown, CornerRadius = UDim.new(0, 6)})

	local layout = create("UIListLayout", {
		Parent = dropdown,
		FillDirection = Enum.FillDirection.Vertical,
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 2)
	})

	for i, name in ipairs(items) do
		local opt = create("TextButton", {
			Parent = dropdown,
			Name = "Option_"..name,
			Size = UDim2.new(1, -4, 0, 24),
			BackgroundColor3 = Color3.fromHex("#334155"),
			Text = name,
			TextColor3 = Color3.fromHex("#F9FAFB"),
			Font = Enum.Font.SourceSansSemibold,
			TextSize = 14,
			BorderSizePixel = 0,
			AutoButtonColor = false,
			ZIndex = 11,
		})
		create("UICorner", {Parent = opt, CornerRadius = UDim.new(0, 5)})

		opt.MouseEnter:Connect(function()
			TweenService:Create(opt, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromHex("#475569")}):Play()
		end)
		opt.MouseLeave:Connect(function()
			TweenService:Create(opt, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromHex("#334155")}):Play()
		end)
		opt.MouseButton1Click:Connect(function()
			dropdown.Visible = false
			if callback then callback(name) end
		end)
	end

	self.Dropdown = dropdown

	-- toggle logic
	self.Button.MouseButton1Click:Connect(function()
		dropdown.Visible = not dropdown.Visible
	end)

	return dropdown
end

--== CLASS: TopLiteBar ==--
function TopLitePlus.new(name)
	local self = setmetatable({}, TopLitePlus)

	self.Name = name or "TopLiteBar"
	self.Buttons = {}

	local gui = create("ScreenGui", {
		Name = self.Name,
		Parent = playerGui,
		ResetOnSpawn = false,
		ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	})

	local bar = create("Frame", {
		Parent = gui,
		Name = "TopBar",
		BackgroundColor3 = Color3.fromHex("#111827"),
		BackgroundTransparency = 0.3,
		Size = UDim2.new(1, 0, 0, 36),
		Position = UDim2.new(0, 0, 0, 0),
		BorderSizePixel = 0,
		ZIndex = 5,
	})
	create("UIListLayout", {
		Parent = bar,
		FillDirection = Enum.FillDirection.Horizontal,
		Padding = UDim.new(0, 6),
		HorizontalAlignment = Enum.HorizontalAlignment.Left,
	})

	self.Gui = gui
	self.Bar = bar
	return self
end

function TopLitePlus:AddButton(icon, tooltip)
	local button = create("TextButton", {
		Parent = self.Bar,
		Name = "Button_"..tooltip,
		Size = UDim2.new(0, 42, 1, -8),
		Position = UDim2.new(0, 0, 0, 4),
		BackgroundColor3 = Color3.fromHex("#1E293B"),
		Text = icon or "ðŸ”˜",
		TextSize = 18,
		TextColor3 = Color3.fromHex("#F9FAFB"),
		Font = Enum.Font.SourceSansSemibold,
		BorderSizePixel = 0,
		AutoButtonColor = false,
		ZIndex = 6,
	})
	create("UICorner", {Parent = button, CornerRadius = UDim.new(0, 6)})

	button.MouseEnter:Connect(function()
		TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromHex("#334155")}):Play()
	end)
	button.MouseLeave:Connect(function()
		TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromHex("#1E293B")}):Play()
	end)

	local newBtn = setmetatable({Button = button, Tooltip = tooltip}, DropdownButton)
	table.insert(self.Buttons, newBtn)
	return newBtn
end

return TopLitePlus1,
        Text = title or "",
        Font = Enum.Font.GothamBold,
        TextSize = 14,
        TextColor3 = self.Theme.Text,
        TextXAlignment = Enum.TextXAlignment.Left,
    })
    local d = new("TextLabel", {
        Parent = frame,
        Size = UDim2.new(1, -12, 1, -40),
        Position = UDim2.new(0, 6, 0, 34),
        BackgroundTransparency = 1,
        Text = text or "",
        Font = Enum.Font.Gotham,
        TextSize = 13,
        TextColor3 = self.Theme.SubText,
        TextWrapped = true,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
    })

    -- appear tween
    frame.AnchorPoint = Vector2.new(0.5,0)
    frame.Position = UDim2.new(0.5, -150, 0, 20)
    frame.BackgroundTransparency = 1
    tweenProps = {BackgroundTransparency = 0}
    local tw = TweenService:Create(frame, TweenInfo.new(0.22), {BackgroundTransparency = 0})
    tw:Play()

    -- auto destroy
    delay(duration, function()
        local t2 = TweenService:Create(frame, TweenInfo.new(0.22), {BackgroundTransparency = 1, Position = UDim2.new(0.5, -150, 0, 20)})
        t2:Play()
        t2.Completed:Wait()
        frame:Destroy()
    end)
    return frame
end

-- Theme setter
function TopBarLib:SetTheme(theme)
    for k,v in pairs(theme or {}) do self.Theme[k] = v end
    -- apply basic colors
    if self._root then
        self._root.BackgroundColor3 = self.Theme.Background
        local title = self._root:FindFirstChild("Title")
        if title then title.TextColor3 = self.Theme.Text end
        for _,btn in pairs(self._buttons) do
            if btn and btn:IsA("GuiObject") then
                btn.TextColor3 = self.Theme.Text
                if btn.BackgroundColor3 then
                    -- keep visual contrast
                end
            end
        end
    end
end

-- Toggle visibility
function TopBarLib:Toggle()
    if self._root then
        self._root.Visible = not self._root.Visible
    end
end

-- Destroy library GUI
function TopBarLib:Destroy()
    if self._root then self._root:Destroy() end
    local nf = self._gui:FindFirstChild("TopBarPlus_Notifs")
    if nf then nf:Destroy() end
end

-- Return library table factory
return setmetatable({}, {
    __call = function(_, ...)
        return TopBarLib.new(...)
    end
})
